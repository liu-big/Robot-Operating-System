# 相机校准数据使用手册

## 1. 概述

`src/calibrationdata/` 文件夹包含用于机器人视觉系统的相机校准数据。这些数据对于确保图像处理的准确性至关重要，例如图像去畸变、立体视觉以及机器人定位和导航中的姿态估计。

### 包含文件：

*   `ost.txt`: 文本格式的相机校准参数。
*   `ost.yaml`: YAML 格式的相机校准参数，通常用于 ROS (Robot Operating System) 环境。
*   `left-00xx.png`: 一系列用于相机校准过程的图像文件。这些图像通常是在不同角度和距离下拍摄的棋盘格或其他校准图案。

## 2. 相机校准参数详解

`ost.txt` 和 `ost.yaml` 文件中包含以下关键相机参数：

*   **`width` / `image_width` 和 `height` / `image_height`**: 相机捕获图像的分辨率（例如，640x480 像素）。
*   **`camera matrix` / `camera_matrix`**: 相机的内参矩阵（也称为 K 矩阵）。它描述了相机从 3D 空间点到 2D 图像平面的投影方式。通常格式为：
    ```
    [fx  0   cx]
    [0   fy  cy]
    [0   0   1 ]
    ```
    其中 `fx`, `fy` 是焦距，`cx`, `cy` 是主点坐标。
*   **`distortion` / `distortion_coefficients`**: 相机的畸变系数。这些系数用于校正图像中由镜头引起的径向和切向畸变。常见的畸变模型（如 `plumb_bob`）通常有 5 个系数：`[k1, k2, t1, t2, k3]`。
*   **`rectification` / `rectification_matrix`**: 校正矩阵（也称为 R 矩阵）。对于立体相机，它用于将图像旋转到共同的平面，以便进行视差计算。对于单目相机，通常是单位矩阵。
*   **`projection` / `projection_matrix`**: 投影矩阵（也称为 P 矩阵）。它结合了内参和外参，用于将 3D 空间点投影到校正后的 2D 图像平面。对于立体相机，它还包含基线信息。

## 3. 使用场景与操作

这些校准数据在机器人项目中具有广泛的应用，特别是在涉及视觉感知的模块中。

### 3.1 图像去畸变 (Undistortion)

**用途：** 消除相机镜头造成的图像畸变，使图像中的直线保持直线，提高图像测量的准确性。

**操作：**

1.  **加载校准参数：** 在 ROS 中，通常使用 `camera_info_manager` 或直接从 `ost.yaml` 文件加载相机内参和畸变系数。
2.  **应用去畸变：** 使用 OpenCV 等图像处理库的函数（如 `cv::undistort()` 或 `cv::initUndistortRectifyMap()` 结合 `cv::remap()`）将畸变图像转换为去畸变图像。

**项目全局应用：**

*   **图像预处理：** 在任何需要精确图像分析的模块（如目标检测、特征匹配、SLAM）之前，对原始图像进行去畸变处理。
*   **导航与定位：** 如果视觉里程计或视觉 SLAM 算法使用相机图像，去畸变是提高其准确性的基础。

### 3.2 立体视觉 (Stereo Vision)

**用途：** 对于双目或多目相机系统，校准数据用于计算深度信息，实现 3D 感知。

**操作：**

1.  **加载左右相机校准参数：** 分别加载左右相机的内参、畸变系数、校正矩阵和投影矩阵。
2.  **立体校正：** 使用 `cv::stereoRectify()` 函数计算左右图像的校正变换，使它们在同一平面上对齐。
3.  **视差计算：** 对校正后的图像应用立体匹配算法（如 SGBM、BM）生成视差图。
4.  **深度重建：** 根据视差图和投影矩阵计算每个像素的 3D 坐标。

**项目全局应用：**

*   **障碍物检测与避障：** 获取环境中障碍物的深度信息，用于路径规划和避障。
*   **3D 重建：** 构建环境的 3D 地图或模型。
*   **物体抓取：** 精确测量物体的 3D 位置和尺寸，指导机械臂抓取。

### 3.3 姿态估计 (Pose Estimation)

**用途：** 根据图像中的已知 3D 点和其对应的 2D 图像点，计算相机相对于物体的姿态（位置和方向）。

**操作：**

1.  **加载相机内参：** 使用 `camera_matrix` 和 `distortion_coefficients`。
2.  **特征点检测与匹配：** 在图像中检测并匹配已知的 3D 目标点（例如，棋盘格角点或 ArUco 标记的角点）。
3.  **PnP 算法：** 使用 `cv::solvePnP()` 等函数，结合 3D-2D 对应点和相机内参，计算相机相对于目标物的旋转向量和平移向量。

**项目全局应用：**

*   **机器人手眼标定：** 确定相机与机器人末端执行器之间的相对姿态。
*   **AR/VR 应用：** 将虚拟物体叠加到真实场景中。
*   **目标跟踪：** 实时跟踪特定目标物的姿态。

### 3.4 相机校准 (Camera Calibration)

**用途：** `left-00xx.png` 图像是用于生成 `ost.txt` 和 `ost.yaml` 这些校准参数的原始数据。当相机参数发生变化（例如更换镜头、相机或焦距调整）时，需要重新进行校准。

**操作：**

1.  **图像采集：** 拍摄一系列包含已知校准图案（如棋盘格）的图像，确保图案在图像中占据不同位置和方向。
2.  **角点检测：** 使用 `cv::findChessboardCorners()` 或 `cv::findCirclesGrid()` 等函数检测图像中的校准图案角点。
3.  **相机校准：** 使用 `cv::calibrateCamera()` 函数，结合 3D 棋盘格点和 2D 图像点，计算相机的内参和畸变系数。
4.  **保存参数：** 将计算出的参数保存为 `yaml` 或 `txt` 格式，供后续使用。

**项目全局应用：**

*   **系统维护：** 当相机硬件配置改变时，重新校准以保持系统准确性。
*   **质量控制：** 定期检查相机校准状态，确保视觉系统性能稳定。

## 4. 总结

`src/calibrationdata/` 文件夹中的文件是机器人视觉系统的基础。理解这些文件的作用及其在不同操作中的应用，对于开发和维护高性能的机器人视觉功能至关重要。通过正确使用这些校准数据，可以确保机器人能够准确地感知和理解其周围环境。